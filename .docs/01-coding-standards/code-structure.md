# コード構造（Code Structure）

## マジックナンバーの禁止

**マジックナンバーは定数として定義する**:

- 計算式に含まれる数値はすべて定数化
- 定数名は計算の意図を明確に表現
  - ❌ `CANVAS_WIDTH = 1080`
  - ✅ `POST_IMAGE_WIDTH = 1080`（投稿画像の幅）
  - ✅ `POST_IMAGE_HEIGHT = 1350`（投稿画像の高さ）

### 原則

- `0`, `1`以外の数値は原則として定数化
- `0`, `1`でも意味が不明確な場合は定数化
- 計算式は定数を使った式で表現

**参考**: Clean Code (Robert C. Martin) - "Avoid Magic Numbers"

## 責務の分離（Separation of Concerns）

**エラーメッセージ生成を分離する**:

- エラーメッセージ生成は専用メソッドに分離
- ビジネスロジックはエラー情報（インデックスなど）のみを渡す
- エラーメッセージ生成メソッドで行番号変換などを行う

### 原則

- エラーメッセージ専用の引数は渡さない
- エラーメッセージ生成は最後の瞬間（例外を投げる直前）に行う
- 変換ロジック（インデックス→行番号など）はヘルパーメソッドに集約

**参考**: Clean Architecture (Robert C. Martin) - "Separation of Concerns"

## ネストの削減

**早期リターンとメソッド抽出でネストを削減**:

- 早期リターンを使用
- ネストが2段階を超える場合はメソッド抽出を検討
- ループ内の処理は可能な限りメソッドに抽出

### 原則

- ネストは2段階まで（インデント2段階まで）
- 3段階以上になる場合はメソッド抽出を検討
- 早期リターンで条件分岐を簡潔に

**参考**: Clean Code (Robert C. Martin) - "Keep Functions Small"

## インデックスと行番号の統一

**コード内では常にインデックスで扱う**:

- コード内では常にインデックス（0始まり）で扱う
- エラーメッセージやログ出力時のみ行番号（1始まり）に変換
- 変換は専用のヘルパーメソッドで行う

### 原則

- 内部表現は統一（インデックス）
- 外部表現（エラーメッセージ、ログ）への変換は最後の瞬間に行う
- 変換ロジックは1箇所に集約

**参考**: Domain-Driven Design - "Ubiquitous Language"

